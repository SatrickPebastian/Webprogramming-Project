<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="icon" href="images/resourceImages/shark.svg">
        <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

        <!-- Sweet alert import -->
        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

        <!-- jQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        
         <!-- Google Fonts -->
       <link href="https://fonts.googleapis.com/css2?family=BioRhyme:wght@700&family=Cabin&display=swap" rel="stylesheet">
        
        <link href="css/background.css" rel="stylesheet">
      
        
        <title>Sign Up</title>
    </head>
    <body>
    
    <header>
        
    </header>
   
        <div class="container p-0" style="width:40%; height:100vh; background-color:rgba(0, 0, 0, 0.253);color:white; float:left;">   
            
            <div id="loginbox" style="margin-top:100px;margin-left:80px;" class="mainbox col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2">     
                
                <h2>Registrierung</h2><br>
            
                   
                <form id="signupform" class="form-horizontal" role="form" method="POST" action="php/signup.php" autocomplete="off">
                    <div id="signupalert" style="display:none" class="alert alert-danger">
                        <p>Error:</p>
                        <span></span>
                    </div>          
                    <div class="form-group" style="margin-bottom: 30px;">
                        <label for="txt_vorname" class="col-md-3 control-label">Vorname</label>
                        <div class="col-md-9">
                            <input id="txt_vorname" name="txt_vorname" placeholder="Vorname" class="form-control bg-dark" required type="text" autocomplete="new-password" onfocus="this.style.color='#d5d6d9'">
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 30px;">
                        <label for="txt_nachname" class="col-md-3 control-label">Nachname</label>
                        <div class="col-md-9">
                            <input id="txt_nachname" name="txt_nachname" placeholder="Nachname" class="form-control bg-dark" required type="text" autocomplete="new-password" onfocus="this.style.color='#d5d6d9'">
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 30px;">
                        <label for="txt_username" class="col-md-3 control-label" style="max-width:200%;">Username<small id="usernameError" style="color:red;visibility:hidden;">&nbsp;&nbsp;&nbsp;Username bereits vergeben.</small></label>
                        <div class="col-md-9">
                            <input id="txt_username" name="txt_username" placeholder="Username" class="form-control bg-dark" required type="text" autocomplete="new-password" onfocus="this.style.color='#d5d6d9'">
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 30px;">
                        <label for="txt_email" class="col-md-3 control-label" style="max-width:200%;">Email<small id="emailError" style="color:red;visibility:hidden;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E-Mail bereits vergeben.</small></label>
                        <div class="col-md-9">
                            <input id="txt_email" name="txt_email" placeholder="Email" class="form-control bg-dark" required type="email" autocomplete="new-password" onfocus="this.style.color='#d5d6d9'">
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 30px;">
                        <label for="txt_straße" class="col-md-3 control-label">Straße</label>
                        <div class="col-md-9">
                            <input id="txt_straße" name="txt_straße" placeholder="Straße" class="form-control bg-dark" required type="text" autocomplete="new-password" onfocus="this.style.color='#d5d6d9'">
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 30px;">
                        <label for="txt_plz" class="col-md-3 control-label" style="max-width:200%">PLZ<small id="plzError" style="color:red;visibility:hidden;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ungültige Eingabe.</small></label>
                        <div class="col-md-9">
    
                            <input id="txt_plz" name="txt_plz" placeholder="PLZ" class="form-control bg-dark" required type="text" autocomplete="new-password" onfocus="this.style.color='#d5d6d9'">
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 30px;">
                        <label for="txt_stadt" class="col-md-3 control-label" style="max-width:200%;">Stadt<small id="stadtError" style="color:red;visibility:hidden;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ungültige Eingabe.</small></label>
                        <div class="col-md-9">
                                
                        <input id="txt_stadt" name="txt_stadt" placeholder="Stadt" class="form-control bg-dark" required type="text" onfocus="this.style.color='#d5d6d9'">
                                
                                    
                                        
                                    
                     </div>
                                
                </div>
            </div>
                            
                            
            <div class="form-group" style="margin-left:95px;">                                        
                <div class="col-md-offset-3 col-md-9">
                    <button id="button1_save" name="button1_save" class="btn btn-primary" type="submit">Registrieren</button>
                    <button type="reset" id="button2_cancel" name="button2_cancel" class="btn btn-light">Abbrechen</button>
                </div>
            </div>  
                <br>
            <div style="font-size: 80%; margin-left:110px;">
                <a href="login.html">
                    Sie haben bereits einen Account?
                </a>
            </div>
        </form>
                    
                   
                                 
                </div>  
            </div>  
        </div>
        <br><br>
        <br><br><br><br><br><br><br><br><br><br><br><br>
        <div class="d-flex justify-content-center">
            <img src="images/resourceImages/shark.svg" width="150" height="auto"><br><br>
        </div>
        <div class="d-flex justify-content-center">
            <span style="font-family: 'BioRhyme', serif; font-size:70px; color:white; cursor:default;">&nbsp;GameShark</span>
        </div>

        <script type="text/javascript">

            const firstname = document.getElementById('txt_vorname');
            const lastname = document.getElementById('txt_nachname');
            
            
            const straße = document.getElementById('txt_straße');
            const plz = document.getElementById('txt_plz');
            const stadt = document.getElementById('txt_stadt');

            const errorElement = document.getElementById('errorMessage');

            const form = document.getElementById('signupform');

            let messages = [];

            let usernameCheckDb = false;
            let emailCheckDb = false;
            var plzCheck = false;
            let stadtCheck = false;

            


            $(document).ready(function(){

                //Mit AJAX überprüfen ob E-Mail bereits registriert wurde.
               $('#txt_email').blur(function(){

                let email = $('#txt_email').val();
                $('#txt_email').css('border', '');
                $('#emailError').css('visibility', 'hidden');

                $.ajax({
                    method: "post",
                    url: "php/checkEmail.php",
                    data: {
                        'email' : email
                    },
                    dataType: "json",
                    success: function(daten){

                        if(daten === true){
                            emailCheckDb = true;
                        }else {
                            emailCheckDb = false;

                            $('#txt_email').css('border', 'solid #FF0000');
                            $('#emailError').css('visibility', 'visible');
                        }
                    },
                    error: function(daten){
                        console.log("etwas ist schiefgelaufen.");
                    }
                });
               });
               

               //Mit AJAX überprüfen ob Username bereits registriert wurde.
               $('#txt_username').blur(function(){

                let username = $('#txt_username').val();
                $('#txt_username').css('border', '');
                $('#usernameError').css('visibility', 'hidden');

                $.ajax({
                    method: "post",
                    url: "php/checkUsername.php",
                    data: {
                        'username' : username
                    },
                    dataType: "json",
                    success: function(daten){

                        if(daten === true){
                            usernameCheckDb = true;
                        }else {
                            usernameCheckDb = false;

                            $('#txt_username').css('border', 'solid #FF0000');
                            $('#usernameError').css('visibility', 'visible');
                        }
                    },
                    error: function(daten){
                        console.log("etwas ist schiefgelaufen.");
                    }
                });
                });


                //Überprüfen ob PLZ gültig ist (genauer: ob PLZ eine Zahl ist)
                $('#txt_plz').blur(function(){

                    let plz = $('#txt_plz').val();
                    
                    $('#plzError').css('visibility', 'hidden');
                    $('#txt_plz').css('border', '');

                    if(isNaN(plz)){
                        plzCheck = false;
                        $('#plzError').css('visibility', 'visible');

                        $('#txt_plz').css('border', 'solid #FF0000');
                    }else {
                        plzCheck = true;
                    }
                });


                //Überprüfen ob Stadt gültig ist (genauer: ob Stadt aus Buchstaben besteht)
                $('#txt_stadt').blur(function(){

                    let stadt = $('#txt_stadt').val();
              
                    $('#txt_stadt').css('border', '');
                    $('#stadtError').css('visibility', 'hidden');

                    

                    if(stadt == ""){
                        stadtCheck = true;
                    }else if(!isNaN(stadt)){
                        stadtCheck = false;
                        $('#stadtError').css('visibility', 'visible');
                        $('#txt_stadt').css('border', 'solid #FF0000');
                    }else {
                        stadtCheck= true;
                    }
                });



                $('#signupform').submit(function(e){
                    e.preventDefault();

                    if(usernameCheckDb == false){
                        messages.push('Username ist bereits vergeben.');
                    }

                    if(emailCheckDb == false){
                        messages.push('E-Mail Addresse ist bereits registriert.');
                    }

                    if(plzCheck == false){
                        messages.push('Bitte gültige PLZ eingeben.');
                    }

                    if(stadtCheck == false){
                        messages.push('Bitte gültige Stadt eingeben.');
                    }

                   


                    if(messages.length > 0){
                        swal({
                            title: "Fehler",
                            icon: "error",
                            text: messages.join('\n')
                        });
                        messages = [];
                    }else {

                        $.ajax({
                        method: "post",
                        url: "php/signup.php",
                        data: {
                            'txt_vorname' : $('#txt_vorname').val(),
                            'txt_nachname' : $('#txt_nachname').val(),
                            'txt_username' : $('#txt_username').val(),
                            'txt_email' : $('#txt_email').val(),
                            'txt_stadt' : $('#txt_stadt').val(),
                            'txt_plz' : $('#txt_plz').val(),
                            'txt_straße' : $('#txt_straße').val()
                        },
                        dataType: "json",
                        success: function(response) {
                            console.log(response);
                        }
                        });

                        swal({
                        title: "Registrierung erfolgreich",
                        icon: "success",
                        text: "Sie haben eine E-Mail mit Ihrem Passwort erhalten."
                        
                        }).then(function(){
                            $('#txt_vorname').val("");
                            $('#txt_nachname').val("");
                            $('#txt_username').val("");
                            $('#txt_email').val("");
                            $('#txt_stadt').val("");
                            $('#txt_plz').val("");
                            $('#txt_straße').val("");
                            window.location = "login.html";
                        });
                    }
                });

                $('#button2_cancel').click(function(e){
                    window.location = 'php/startpage.php';
                });
            });


          </script>

    </body>
</htlm>